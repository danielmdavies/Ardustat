<head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name ="viewport" content="width=device-width">
    <title>Channel 1</title>
    <link rel="stylesheet" href="/bootstrap/dist/css/bootstrap.min.css"> 
    <link rel="stylesheet" href="/stylesheets/style.css">
</head>

<body>
  <div class="container">
    <div class="row marketing">
    
      <div class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
          <div class="navbar-header">
            <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Ardustat</a>
          </div>
          <nav class="collapse navbar-collapse" role="navigation">
            <ul class="nav navbar-nav navbar-right">
                <li id='navbar-home'><a href="/">Home</a></li>
                <li id='navbar-channel1'><a href="/Channel1">Channel 1</a></li>
                <li id='navbar-channel2'><a href="/Channel2">Channel 2</a></li>
                <li id='navbar-channel3'><a href="/Channel3">Channel 3</a></li>
                <li id='navbar-analysis'><a href="/Analysis">Analysis</a></li>
            </ul>
          </nav>
        </div>
        <script type="text/javascript" >
            document.getElementById('navbar-analysis').setAttribute('class', 'active')
          </script>
      </div>
   I know this is ugly - I will make it prettier.
      <div class="col-lg-12">
        <h1>Analysis</h1>
        <div>
		      <h4>Folders</h4>
		      ##_newthings_##
        </div>
       
        <h4>Files</h4>
        <div id='files'>
        </div>

        <h4>Results</h4>
        <img id="graph" src="http://coolstuffiknow.files.wordpress.com/2012/04/cool_003.jpg" width and height stuff>

      </div>  
    </div>
  </div>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" ></script>
	<script src="/javascripts/flot/jquery.flot.js"></script>
	<script src="/javascripts/flot/jquery.flot.time.js"></script>
	<script src="/javascripts/jquery-json/src/jquery.json.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
  <script src ="/scripts/test.js"></script>
  <script src="/scripts/socket_1.js"></script>
  <script>

  var analysis_folder_name
    files = '';
    $( "#folders" ).children().on( "click", function( event ) 
    {
      analysis_folder_name = this.id;
      console.log(analysis_folder_name);
      //make an AJAX request to get file_list 
      //display file_list
      $.ajax({
        type:'POST',
        url:'/show_files',
        async: true,
        data: {'folder':analysis_folder_name},
        success: function(results)
        {
          console.log('successful sending of things :)')
          files = results;
          console.log(files);
          showFiles(files);
        }   
      });  
    });
    


  function analysis_get_image(address)
    {
        //TODO: add in a cycmin and cycmax thing

        analysis_file_name = address
        console.log('analysis_get_image called for ' + address)

        this_host = document.URL.toString().split('/')[2]
        colon_index = this_host.indexOf(':')
        this_host = this_host.substring(0,colon_index)
        console.log(this_host)
        url = "http://"+this_host+":4004/filetest_showme_basic_averaging/" 
        + analysis_folder_name+"/"
        + analysis_file_name+"/"
        + "0/"
        + "-1/"
        + "t"+"/"
        + "v"+"/",
        $.ajax({
        url: url,
        success: function(result){
            image = result
            imageUrl = "http://localhost:4001/"+image
            //document.write(imageUrl);
            changeImage("graph",imageUrl)
        },
        async:   true,
        })
    }
  
  function changeImage(id,source)
  {
  document.getElementById(id).src=source;
  }


  function showFiles(files){
    dom_files = document.getElementById('files');
    while (dom_files.firstChild) {
      dom_files.removeChild(dom_files.firstChild)
    }
    for (var i in files){
      foo = files[i].toString()
      if ( (foo.indexOf('raw') > -1 ) || (foo.indexOf('setup') > -1 ) ){ }
      else {
        console.log('file is '+ foo);
        this_button = document.createElement('input');
        this_button.type = "button"
        this_button.setAttribute('id', foo)
        this_button.setAttribute('value', foo)
        this_button.onclick = function() {
          analysis_get_image(this.value)
        }
        dom_files.appendChild(this_button)
      }
    }
  }




  </script>
</body>
